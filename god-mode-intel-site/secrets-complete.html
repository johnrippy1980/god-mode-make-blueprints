<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALL SECRETS FOUND - GOD MODE INTEL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Press Start 2P', monospace;
        }

        .ending-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        .ending-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            opacity: 0;
            transition: opacity 2s ease-in-out;
        }

        .ending-image.visible {
            opacity: 1;
        }

        .ending-image.fade-out {
            opacity: 0;
        }

        #end3 {
            z-index: 2;
        }

        #end2 {
            z-index: 1;
        }

        .ending-text {
            position: fixed;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            color: #8b0000;
            font-size: 14px;
            text-align: center;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #8b0000;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 10;
            letter-spacing: 2px;
        }

        .ending-text.visible {
            opacity: 1;
        }

        .ending-title {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #4a9c5a;
            font-size: 24px;
            text-align: center;
            text-shadow: 0 0 10px #4a9c5a, 0 0 30px #2d5e36;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 10;
            letter-spacing: 4px;
        }

        .ending-title.visible {
            opacity: 1;
        }

        .stats-display {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffcc00;
            font-size: 12px;
            text-align: center;
            text-shadow: 0 0 5px #ffcc00;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 10;
        }

        .stats-display.visible {
            opacity: 1;
        }

        .return-btn {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(180deg, #8b0000 0%, #4a0000 100%);
            border: 2px solid #ff0000;
            color: #fff;
            padding: 15px 30px;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 1s ease-in-out, transform 0.2s, box-shadow 0.2s;
            z-index: 10;
            text-shadow: 0 0 5px #000;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        }

        .return-btn:hover {
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
        }

        .return-btn.visible {
            opacity: 1;
        }

        /* Scanlines effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
        }

        /* Blood drip decoration */
        .blood-drips {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .blood-drip {
            position: absolute;
            top: -100px;
            width: 4px;
            background: linear-gradient(180deg, #8b0000 0%, #4a0000 50%, transparent 100%);
            border-radius: 0 0 50% 50%;
            animation: drip 8s ease-in infinite;
        }

        @keyframes drip {
            0% { top: -100px; opacity: 0.8; }
            100% { top: 110%; opacity: 0; }
        }

        /* Pulsing glow on images */
        @keyframes pulse-glow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(139, 0, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(139, 0, 0, 0.8)); }
        }

        .ending-image.visible {
            animation: pulse-glow 3s ease-in-out infinite;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="ending-container">
        <img id="end3" class="ending-image" src="/images/sprites/END3.png" alt="The Terror Mask">
        <img id="end2" class="ending-image" src="/images/sprites/END2.png" alt="Victory">
    </div>

    <div class="ending-title" id="title">ALL SECRETS FOUND</div>
    <div class="stats-display" id="stats">FINAL SCORE: <span id="final-score">0</span></div>
    <div class="ending-text" id="text">THE MASK HAS REVEALED ALL ITS SECRETS...</div>
    <button class="return-btn" id="return-btn">CONTINUE THE HUNT</button>

    <div class="blood-drips" id="blood-drips"></div>
    <div class="scanlines"></div>

    <script>
        // Get final score from localStorage
        const finalScore = localStorage.getItem('godmode_score') || 0;
        document.getElementById('final-score').textContent = finalScore;

        // Create blood drips
        const bloodContainer = document.getElementById('blood-drips');
        for (let i = 0; i < 15; i++) {
            const drip = document.createElement('div');
            drip.className = 'blood-drip';
            drip.style.left = Math.random() * 100 + '%';
            drip.style.height = (50 + Math.random() * 100) + 'px';
            drip.style.animationDelay = Math.random() * 8 + 's';
            drip.style.animationDuration = (6 + Math.random() * 4) + 's';
            bloodContainer.appendChild(drip);
        }

        // Ending sequence
        const end3 = document.getElementById('end3');
        const end2 = document.getElementById('end2');
        const title = document.getElementById('title');
        const stats = document.getElementById('stats');
        const text = document.getElementById('text');
        const returnBtn = document.getElementById('return-btn');

        // Audio context for dramatic sound
        let audioCtx = null;

        function playDramaticSound() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            // Deep rumble
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(50, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 3);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
        }

        function playVictoryChime() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0, audioCtx.currentTime + i * 0.2);
                gain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + i * 0.2 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.2 + 0.8);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.2);
                osc.stop(audioCtx.currentTime + i * 0.2 + 1);
            });
        }

        // Start the sequence
        setTimeout(() => {
            // Show END3 first (the mask)
            end3.classList.add('visible');
            title.classList.add('visible');
            playDramaticSound();
        }, 500);

        setTimeout(() => {
            stats.classList.add('visible');
        }, 2000);

        setTimeout(() => {
            // Fade out END3, show END2
            end3.classList.remove('visible');
            end3.classList.add('fade-out');
        }, 5000);

        setTimeout(() => {
            // Show END2 (victory scene)
            end2.classList.add('visible');
            text.textContent = 'YOU HAVE CONQUERED THE DARKNESS';
            text.classList.add('visible');
            playVictoryChime();
        }, 6000);

        setTimeout(() => {
            returnBtn.classList.add('visible');
        }, 8000);

        // Return button resets secrets and goes back
        returnBtn.addEventListener('click', () => {
            // Reset secrets count but keep score as trophy
            localStorage.setItem('godmode_secrets', '0');
            localStorage.setItem('godmode_insanity', '0');
            window.location.href = '/';
        });

        // Allow skipping with any key after 3 seconds
        let canSkip = false;
        setTimeout(() => { canSkip = true; }, 3000);

        document.addEventListener('keydown', () => {
            if (canSkip && !returnBtn.classList.contains('visible')) {
                end3.classList.remove('visible');
                end3.classList.add('fade-out');
                end2.classList.add('visible');
                title.classList.add('visible');
                stats.classList.add('visible');
                text.textContent = 'YOU HAVE CONQUERED THE DARKNESS';
                text.classList.add('visible');
                returnBtn.classList.add('visible');
                playVictoryChime();
            }
        });
    </script>
</body>
</html>
